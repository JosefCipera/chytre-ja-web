<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Dashboard Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        h1 {
            display: block;
            /* Zajišťuje, že nadpis bude vždy viditelný */
            font-size: 1.125rem;
            font-weight: 400;
            /* Normální tloušťka písma (neboldované) */
            color: #6b7280;
            text-align: left;
            margin: 0;
            padding: 0.75rem 1.5rem;
            /* Odsazení, aby nebyl nalepený na kraji */
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
            transition: transform 0.15s ease-in-out;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
        }

        .card-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-top: 0.25rem;
        }

        .card-value.red {
            color: #ef4444;
        }

        .card-value.green {
            color: #10b981;
        }

        .card-value.purple {
            color: #8b5cf6;
        }

        .card-canvas {
            width: 100%;
            height: 6rem;
            margin-top: auto;
        }

        .card-canvas.gauge {
            height: 10rem;
        }

        .text-center {
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">

        <div class="grid">
            <div class="card" onmouseenter="animateChart('salesCanvas')" onmouseleave="resetChart('salesCanvas')">
                <div>
                    <div class="card-title">Tržby</div>
                    <div class="card-value green">158,5 tis. Kč</div>
                </div><canvas id="salesCanvas" class="card-canvas"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('cashflowCanvas')" onmouseleave="resetChart('cashflowCanvas')">
                <div>
                    <div class="card-title">Cash Flow</div>
                    <div class="card-value red">-32 000 Kč</div>
                </div><canvas id="cashflowCanvas" class="card-canvas"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('expensesCanvas')" onmouseleave="resetChart('expensesCanvas')">
                <div>
                    <div class="card-title">Náklady</div>
                    <div class="card-value">85,2 tis. Kč</div>
                </div><canvas id="expensesCanvas" class="card-canvas"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('profitabilityCanvas')"
                onmouseleave="resetChart('profitabilityCanvas')">
                <div>
                    <div class="card-title text-center">Ziskovost</div>
                    <div class="card-value green text-center">45 %</div>
                </div><canvas id="profitabilityCanvas" class="card-canvas gauge"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('clientsCanvas')" onmouseleave="resetChart('clientsCanvas')">
                <div>
                    <div class="card-title">Počet klientů</div>
                    <div class="card-value">456</div>
                </div><canvas id="clientsCanvas" class="card-canvas"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('stockCanvas')" onmouseleave="resetChart('stockCanvas')">
                <div>
                    <div class="card-title">Skladové zásoby</div>
                    <div class="card-value">550 tis. Kč</div>
                </div><canvas id="stockCanvas" class="card-canvas"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('throughputCanvas')"
                onmouseleave="resetChart('throughputCanvas')">
                <div>
                    <div class="card-title">Průtok</div>
                    <div class="card-value">80 tis. Kč</div>
                </div><canvas id="throughputCanvas" class="card-canvas"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('deliveryCanvas')" onmouseleave="resetChart('deliveryCanvas')">
                <div>
                    <div class="card-title text-center">Včasnost dodávek</div>
                    <div class="card-value purple text-center">98 %</div>
                </div><canvas id="deliveryCanvas" class="card-canvas gauge"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('productivityCanvas')"
                onmouseleave="resetChart('productivityCanvas')">
                <div>
                    <div class="card-title">Produktivita</div>
                    <div class="card-value">1,2</div>
                </div><canvas id="productivityCanvas" class="card-canvas"></canvas>
            </div>
            <div class="card" onmouseenter="animateChart('bottleneckCanvas')"
                onmouseleave="resetChart('bottleneckCanvas')">
                <div>
                    <div class="card-title text-center">Využití hrdla</div>
                    <div class="card-value text-center">85 %</div>
                </div><canvas id="bottleneckCanvas" class="card-canvas gauge"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Deklarace proměnných, které naplníme z JSONu
        let salesData = [], cashflowData = [], expensesData = [], clientsData = [], stockData = [],
            throughputData = [], productivityData = [], profitabilityValue = 0, deliveryValue = 0, bottleneckValue = 0;

        // --- PLNÉ VERZE FUNKCÍ PRO KRESLENÍ GRAFŮ ---
        function drawLineChart(canvas, data, color, pointIndex, isAnimating, animationValue) {
            if (!canvas || !canvas.getContext) return;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const maxVal = Math.max(...data);
            const minVal = Math.min(...data);
            const range = maxVal - minVal || 1;

            ctx.beginPath();
            ctx.lineWidth = 4;
            ctx.strokeStyle = color;

            const animatedDataLength = isAnimating ? Math.floor(data.length * animationValue) : data.length;

            for (let i = 0; i < animatedDataLength; i++) {
                const value = data[i];
                const x = (i / (data.length - 1)) * rect.width;
                const y = range === 1 ? rect.height / 2 : (1 - ((value - minVal) / range)) * rect.height;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();

            if (animatedDataLength === data.length) {
                const value = data[pointIndex];
                const pointX = (pointIndex / (data.length - 1)) * rect.width;
                const pointY = range === 1 ? rect.height / 2 : (1 - ((value - minVal) / range)) * rect.height;

                ctx.beginPath();
                ctx.arc(pointX, pointY, 6, 0, 2 * Math.PI);
                ctx.fillStyle = '#ffffff';
                ctx.fill();
                ctx.lineWidth = 2;
                ctx.strokeStyle = color;
                ctx.stroke();
            }
        }

        function drawBarChart(canvas, data, color, highlightIndex, isAnimating, animationValue) {
            if (!canvas || !canvas.getContext) return;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const maxVal = Math.max(...data);
            const minVal = Math.min(0, ...data);
            const range = maxVal - minVal || 1;

            const barWidth = (rect.width / data.length) * 0.7;
            const gap = (rect.width / data.length) * 0.3;
            const zeroLineY = range === 1 ? rect.height / 2 : (1 - (0 - minVal) / range) * rect.height;
            const radius = 5;

            data.forEach((value, index) => {
                const x = index * (barWidth + gap) + gap / 2;
                let barHeight = range === 1 ? 0 : Math.abs(value / range) * rect.height;
                if (isAnimating) {
                    barHeight *= animationValue;
                }
                const y = value >= 0 ? zeroLineY - barHeight : zeroLineY;

                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + barWidth - radius, y);
                ctx.arcTo(x + barWidth, y, x + barWidth, y + radius, radius);
                ctx.lineTo(x + barWidth, y + barHeight - radius);
                ctx.arcTo(x + barWidth, y + barHeight, x + barWidth - radius, y + barHeight, radius);
                ctx.lineTo(x + radius, y + barHeight);
                ctx.arcTo(x, y + barHeight, x, y + barHeight - radius, radius);
                ctx.lineTo(x, y + radius);
                ctx.arcTo(x, y, x + radius, y, radius);
                ctx.closePath();

                ctx.fillStyle = color;
                ctx.fill();
            });
        }

        function drawGaugeChart(canvas, value, maxValue, color, isAnimating, animationValue) {
            if (!canvas || !canvas.getContext) return;
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const outerRadius = Math.min(centerX, centerY) * 0.8;
            const innerRadius = outerRadius * 0.7;
            const startAngle = -Math.PI / 2;

            ctx.beginPath();
            ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
            ctx.arc(centerX, centerY, innerRadius, 2 * Math.PI, 0, true);
            ctx.fillStyle = '#e5e7eb';
            ctx.fill();

            const normalizedValue = Math.min(Math.max(value, 0), maxValue);
            let endAngle = startAngle + (normalizedValue / maxValue) * 2 * Math.PI;
            if (isAnimating) {
                endAngle = startAngle + (normalizedValue / maxValue) * 2 * Math.PI * animationValue;
            }
            ctx.beginPath();
            ctx.arc(centerX, centerY, outerRadius, startAngle, endAngle);
            ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);
            ctx.fillStyle = color;
            ctx.fill();
        }

        // --- ZBYTEK SKRIPTU ZŮSTÁVÁ STEJNÝ ---
        let animationFrameId = null; let animationStartTime = null; let animationValue = 1; let currentCanvasId = null;
        function animateChart(canvasId) {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            animationValue = 0;
            animationStartTime = performance.now();
            currentCanvasId = canvasId;
            function animate(timestamp) {
                const duration = 1000;
                animationValue = Math.min(1, (timestamp - animationStartTime) / duration);
                renderSingleChart(currentCanvasId, true, animationValue);
                if (animationValue < 1) {
                    animationFrameId = requestAnimationFrame(animate);
                }
            }
            animationFrameId = requestAnimationFrame(animate);
        }
        function resetChart(canvasId) {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            animationValue = 1;
            renderSingleChart(canvasId, false, 1);
        }
        function renderSingleChart(id, isAnimating, animationValue) {
            const canvas = document.getElementById(id);
            if (!canvas) return;
            const charts = {
                'salesCanvas': () => drawLineChart(canvas, salesData, '#10b981', 1, isAnimating, animationValue),
                'cashflowCanvas': () => drawLineChart(canvas, cashflowData, '#ef4444', 3, isAnimating, animationValue),
                'expensesCanvas': () => drawLineChart(canvas, expensesData, '#3b82f6', expensesData.length - 2, isAnimating, animationValue),
                'clientsCanvas': () => drawLineChart(canvas, clientsData, '#f59e0b', Math.floor(clientsData.length / 3) + 1, isAnimating, animationValue),
                'throughputCanvas': () => drawLineChart(canvas, throughputData, '#8b5cf6', throughputData.length - 3, isAnimating, animationValue),
                'productivityCanvas': () => drawLineChart(canvas, productivityData, '#f97316', 1, isAnimating, animationValue),
                'stockCanvas': () => drawBarChart(canvas, stockData, '#60a5fa', stockData.length - 3, isAnimating, animationValue),
                'profitabilityCanvas': () => drawGaugeChart(canvas, profitabilityValue, 100, '#10b981', isAnimating, animationValue),
                'deliveryCanvas': () => drawGaugeChart(canvas, deliveryValue, 100, '#8b5cf6', isAnimating, animationValue),
                'bottleneckCanvas': () => drawGaugeChart(canvas, bottleneckValue, 100, '#14b8a6', isAnimating, animationValue)
            };
            if (charts[id]) charts[id]();
        }
        function renderCharts() {
            const canvasIds = ['salesCanvas', 'cashflowCanvas', 'expensesCanvas', 'profitabilityCanvas', 'clientsCanvas', 'stockCanvas', 'throughputCanvas', 'deliveryCanvas', 'productivityCanvas', 'bottleneckCanvas'];
            canvasIds.forEach(id => renderSingleChart(id, false, 1));
        }

        window.addEventListener('load', () => {
            fetch('minidashboard-data.json?v=' + new Date().getTime())
                .then(response => {
                    if (!response.ok) throw new Error('Soubor minidashboard-data.json nenalezen.');
                    return response.json();
                })
                .then(data => {
                    salesData = data.salesData; cashflowData = data.cashflowData; expensesData = data.expensesData;
                    clientsData = data.clientsData; stockData = data.stockData; throughputData = data.throughputData;
                    productivityData = data.productivityData; profitabilityValue = data.profitabilityValue;
                    deliveryValue = data.deliveryValue; bottleneckValue = data.bottleneckValue;
                    setTimeout(renderCharts, 0);
                })
                .catch(error => {
                    console.error('Chyba při načítání dat pro dashboard:', error);
                    document.querySelector('.container').innerHTML = '<h1>Chyba při načítání dat</h1>';
                });
        });

        window.addEventListener('resize', renderCharts);
    </script>
</body>

</html>