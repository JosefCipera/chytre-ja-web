<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plán výroby - Chytré Já</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }

        .table-container {
            max-width: 1280px;
            margin: 1rem auto;
            padding: 0 1rem;
        }

        .table-heading {
            display: block;
            /* Zajišťuje, že nadpis bude vždy viditelný */
            font-size: 1.125rem;
            font-weight: 400;
            /* Normální tloušťka písma (neboldované) */
            color: #6b7280;
            text-align: left;
            margin: 0;
            padding: 0.75rem 1.5rem;
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-controls {
            margin-bottom: 1rem;
            text-align: right;
        }

        .table-responsive {
            overflow-x: auto;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            min-width: 120px;
            white-space: nowrap;
        }

        th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th:hover {
            background-color: #f3f4f6;
        }

        th.sort-asc::after {
            content: ' ▲';
            font-size: 0.8em;
        }

        th.sort-desc::after {
            content: ' ▼';
            font-size: 0.8em;
        }

        tr:hover {
            background-color: #f3f4f6;
        }

        td {
            color: #374151;
            font-size: 0.9rem;
        }

        .value-positive {
            color: #10b981;
        }

        .value-negative {
            color: #ef4444;
        }

        .value-warning {
            color: #f59e0b;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.25rem;
            background-color: #ffffff;
            cursor: pointer;
        }

        .pagination button:hover {
            background-color: #f3f4f6;
        }

        .pagination button:disabled {
            background-color: #e5e7eb;
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>

<body>
    <div class="table-container">

        <div class="table-controls">
            <label for="rowsPerPage">Řádků na stránku: </label>
            <select id="rowsPerPage">
                <option value="10">10</option>
                <option value="15" selected>15</option>
                <option value="25">25</option>
                <option value="50">50</option>
            </select>
        </div>
        <div class="table-responsive">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th data-sort="ID zakázky">ID zakázky</th>
                        <th data-sort="Název zakázky">Název zakázky</th>
                        <th data-sort="Vyrobit ks">Vyrobit ks</th>
                        <th data-sort="Odvedeno ks">Odvedeno ks</th>
                        <th data-sort="Zbývá vyrobit ks">Zbývá vyrobit ks</th>
                        <th data-sort="Termín dodání">Termín dodání</th>
                        <th data-sort="Průběžná doba">Průběžná doba</th>
                        <th data-sort="Typ zakázky">Typ zakázky</th>
                        <th data-sort="Stav">Stav</th>
                        <th data-sort="Časové plnění v %">Časové plnění %</th>
                        <th data-sort="Zpoždění dny">Zpoždění dny</th>
                        <th data-sort="Důvod zpoždění">Důvod zpoždění</th>
                        <th data-sort="Kontrola dat">Kontrola dat</th>
                        <th data-sort="Brusky minut">Brusky minut</th>
                        <th data-sort="Soustruhy minut">Soustruhy minut</th>
                        <th data-sort="Svařování minut">Svařování minut</th>
                        <th data-sort="Laser minut">Laser minut</th>
                        <th data-sort="Ohyb minut">Ohyb minut</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="pagination">
            <button id="prevPage">Předchozí</button>
            <span id="pageInfo"></span>
            <button id="nextPage">Další</button>
        </div>
    </div>

    <script>
        let tableData = [];
        let currentPage = 1;
        let currentSort = { column: null, order: 'asc' };

        function excelDateToJSDate(excelDate) {
            if (!excelDate || isNaN(excelDate)) return "";
            const date = new Date((excelDate - 25569) * 86400 * 1000);
            return date.toLocaleDateString('cs-CZ');
        }

        function renderTable(data, page = 1, rowsPerPage = 15) {
            currentPage = page;
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = data.slice(start, end);

            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';

            paginatedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row['ID zakázky'] || ''}</td>
                    <td>${row['Název zakázky'] || ''}</td>
                    <td class="value-positive">${row['Vyrobit ks'] || 0}</td>
                    <td>${row['Odvedeno ks'] || 0}</td>
                    <td class="${(row['Zbývá vyrobit ks'] || 0) > 0 ? 'value-warning' : 'value-positive'}">${row['Zbývá vyrobit ks'] || 0}</td>
                    <td>${excelDateToJSDate(row['Termín dodání'])}</td>
                    <td>${row['Průběžná doba'] || ''}</td>
                    <td>${row['Typ zakázky'] || ''}</td>
                    <td>${row['Stav'] || ''}</td>
                    <td class="${(row['Časové plnění v %'] || 0) < 100 ? 'value-negative' : 'value-positive'}">${row['Časové plnění v %'] || ''}%</td>
                    <td class="${(row['Zpoždění dny'] || 0) > 0 ? 'value-negative' : ''}">${row['Zpoždění dny'] || ''}</td>
                    <td>${row['Důvod zpoždění'] || ''}</td>
                    <td class="${row['Kontrola dat'] === 'ok' ? 'value-positive' : 'value-negative'}">${row['Kontrola dat'] || ''}</td>
                    <td>${row['Brusky minut'] || ''}</td>
                    <td>${row['Soustruhy minut'] || ''}</td>
                    <td>${row['Svařování minut'] || ''}</td>
                    <td>${row['Laser minut'] || ''}</td>
                    <td>${row['Ohyb minut'] || ''}</td>
                `;
                tbody.appendChild(tr);
            });

            const totalPages = Math.ceil(data.length / rowsPerPage);
            document.getElementById('pageInfo').textContent = `Strana ${page} z ${totalPages}`;
            document.getElementById('prevPage').disabled = page === 1;
            document.getElementById('nextPage').disabled = page === totalPages;
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.order = 'asc';
            }

            tableData.sort((a, b) => {
                const valA = a[column] || '';
                const valB = b[column] || '';
                const numA = parseFloat(valA);
                const numB = parseFloat(valB);
                if (!isNaN(numA) && !isNaN(numB)) {
                    return currentSort.order === 'asc' ? numA - numB : numB - numA;
                }
                return currentSort.order === 'asc'
                    ? String(valA).localeCompare(String(valB), 'cs-CZ')
                    : String(valB).localeCompare(String(valA), 'cs-CZ');
            });

            document.querySelectorAll('#dataTable th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.getAttribute('data-sort') === column) {
                    th.classList.add(`sort-${currentSort.order}`);
                }
            });

            const rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
            renderTable(tableData, 1, rowsPerPage);
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetch('production-plan.json?v=' + new Date().getTime())
                .then(response => {
                    if (!response.ok) throw new Error('Soubor production-plan.json nenalezen.');
                    return response.json();
                })
                .then(data => {
                    tableData = data;
                    const rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
                    renderTable(tableData, 1, rowsPerPage);
                })
                .catch(error => {
                    console.error('Chyba při načítání dat plánu výroby:', error);
                    document.querySelector('#dataTable tbody').innerHTML = `<tr><td colspan="18" style="text-align:center; color: red;">Nepodařilo se načíst data. Zkontrolujte, zda soubor production-plan.json existuje a je ve správném formátu.</td></tr>`;
                });

            document.querySelectorAll('#dataTable th').forEach(th => {
                th.addEventListener('click', () => sortTable(th.getAttribute('data-sort')));
            });

            document.getElementById('prevPage').addEventListener('click', () => {
                const rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
                renderTable(tableData, currentPage - 1, rowsPerPage);
            });

            document.getElementById('nextPage').addEventListener('click', () => {
                const rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
                renderTable(tableData, currentPage + 1, rowsPerPage);
            });

            document.getElementById('rowsPerPage').addEventListener('change', (e) => {
                const rowsPerPage = parseInt(e.target.value);
                renderTable(tableData, 1, rowsPerPage);
            });
        });
    </script>
</body>

</html>